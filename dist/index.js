"use strict";var y=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var z=Object.prototype.hasOwnProperty;var C=(r,e)=>{for(var t in e)y(r,t,{get:e[t],enumerable:!0})},M=(r,e,t,d)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of g(e))!z.call(r,s)&&s!==t&&y(r,s,{get:()=>e[s],enumerable:!(d=x(e,s))||d.enumerable});return r};var R=r=>M(y({},"__esModule",{value:!0}),r);var E={};C(E,{createZodRoute:()=>w});module.exports=R(E);var i=class extends Error{constructor(e){super(e),this.name="InternalRouteHandlerError"}},l=class r{config;middlewares;handleServerError;handleFormData;metadataValue;contextType;constructor({config:e={paramsSchema:void 0,querySchema:void 0,bodySchema:void 0,metadataSchema:void 0},middlewares:t=[],handleServerError:d,handleFormData:s,contextType:c,metadataValue:m}){this.config=e,this.middlewares=t,this.handleServerError=d,this.handleFormData=s,this.contextType=c,this.metadataValue=m}params(e){return new r({...this,config:{...this.config,paramsSchema:e}})}query(e){return new r({...this,config:{...this.config,querySchema:e}})}body(e){return new r({...this,config:{...this.config,bodySchema:e}})}defineMetadata(e){return new r({...this,config:{...this.config,metadataSchema:e}})}metadata(e){return new r({...this,metadataValue:e})}use(e){return new r({...this,middlewares:[...this.middlewares,e],contextType:{}})}handler(e){return async(t,d)=>{try{let s=new URL(t.url),c=d?.params?await d.params:{},m=Object.fromEntries([...s.searchParams.keys()].map(a=>{let o=s.searchParams.getAll(a);return o.length===1?[a,o[0]]:[a,o]})),h=this.metadataValue,u={};if(t.method!=="GET"&&t.method!=="DELETE")try{let a=t.headers.get("content-type")||"";if(a.includes("multipart/form-data")||a.includes("application/x-www-form-urlencoded")){let o=await t.formData();u=this.handleFormData?this.handleFormData(o):Object.fromEntries(o.entries())}else u=await t.json()}catch(a){if(this.config.bodySchema)throw new i(JSON.stringify({message:"Invalid body",errors:a}))}if(this.config.paramsSchema){let a=this.config.paramsSchema.safeParse(c);if(!a.success)throw new i(JSON.stringify({message:"Invalid params",errors:a.error.issues}));c=a.data}if(this.config.querySchema){let a=this.config.querySchema.safeParse(m);if(!a.success)throw new i(JSON.stringify({message:"Invalid query",errors:a.error.issues}));m=a.data}if(this.config.bodySchema){let a=this.config.bodySchema.safeParse(u);if(!a.success)throw new i(JSON.stringify({message:"Invalid body",errors:a.error.issues}));u=a.data}if(this.config.metadataSchema&&h!==void 0){let a=this.config.metadataSchema.safeParse(h);if(!a.success)throw new i(JSON.stringify({message:"Invalid metadata",errors:a.error.issues}));h=a.data}let T={},f=async a=>{if(a>=this.middlewares.length)try{let n=await e(t,{params:c,query:m,body:u,ctx:T,metadata:h});return n instanceof Response?n:new Response(JSON.stringify(n),{status:200,headers:{"Content-Type":"application/json"}})}catch(n){return S(n,this.handleServerError)}let o=this.middlewares[a];if(!o)return f(a+1);let p=async(n={})=>(n.ctx&&(T={...T,...n.ctx}),await f(a+1));try{let n=await o({request:t,params:c,query:m,body:u,ctx:T,metadata:h,next:p});return n instanceof Response||(T={...T}),n}catch(n){return S(n,this.handleServerError)}};return f(0)}catch(s){return S(s,this.handleServerError)}}}},S=(r,e)=>r instanceof i?new Response(r.message,{status:400}):e?e(r):new Response(JSON.stringify({message:"Internal server error"}),{status:500});function w(r){return new l({handleServerError:r?.handleServerError,contextType:{}})}0&&(module.exports={createZodRoute});
//# sourceMappingURL=index.js.map