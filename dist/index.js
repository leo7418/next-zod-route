"use strict";var h=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var z=Object.prototype.hasOwnProperty;var S=(a,e)=>{for(var r in e)h(a,r,{get:e[r],enumerable:!0})},F=(a,e,r,u)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of g(e))!z.call(a,o)&&o!==r&&h(a,o,{get:()=>e[o],enumerable:!(u=R(e,o))||u.enumerable});return a};var M=a=>F(h({},"__esModule",{value:!0}),a);var E={};S(E,{createZodRoute:()=>f});module.exports=M(E);var d=class extends Error{constructor(e){super(e),this.name="InternalRouteHandlerError"}},p=class a{config;middlewares;handleServerError;handleFormData;metadataValue;contextType;constructor({config:e={paramsSchema:void 0,querySchema:void 0,bodySchema:void 0,metadataSchema:void 0},middlewares:r=[],handleServerError:u,handleFormData:o,contextType:i,metadataValue:T}){this.config=e,this.middlewares=r,this.handleServerError=u,this.handleFormData=o,this.contextType=i,this.metadataValue=T}params(e){return new a({config:{...this.config,paramsSchema:e},middlewares:this.middlewares,handleServerError:this.handleServerError,handleFormData:this.handleFormData,contextType:this.contextType,metadataValue:this.metadataValue})}query(e){return new a({config:{...this.config,querySchema:e},middlewares:this.middlewares,handleServerError:this.handleServerError,handleFormData:this.handleFormData,contextType:this.contextType,metadataValue:this.metadataValue})}body(e){return new a({config:{...this.config,bodySchema:e},middlewares:this.middlewares,handleServerError:this.handleServerError,handleFormData:this.handleFormData,contextType:this.contextType,metadataValue:this.metadataValue})}defineMetadata(e){return new a({config:{...this.config,metadataSchema:e},middlewares:this.middlewares,handleServerError:this.handleServerError,handleFormData:this.handleFormData,contextType:this.contextType,metadataValue:void 0})}metadata(e){return new a({...this,metadataValue:e})}use(e){return new a({...this,middlewares:[...this.middlewares,e],contextType:{}})}handler(e){return async(r,u)=>{try{let o=new URL(r.url),i=u?.params?await u.params:{},T=Object.fromEntries([...o.searchParams.keys()].map(t=>{let s=o.searchParams.getAll(t);return s.length===1?[t,s[0]]:[t,s]})),c=this.metadataValue,m={};if(r.method!=="GET"&&r.method!=="DELETE")try{let t=r.headers.get("content-type")||"";if(t.includes("multipart/form-data")||t.includes("application/x-www-form-urlencoded")){let s=await r.formData();m=this.handleFormData?this.handleFormData(s):Object.fromEntries(s.entries())}else m=await r.json()}catch(t){if(this.config.bodySchema)throw new d(JSON.stringify({message:"Invalid body",errors:t}))}if(this.config.paramsSchema){let t=this.config.paramsSchema.safeParse(i);if(!t.success)throw new d(JSON.stringify({message:"Invalid params",errors:t.error.issues}));i=t.data}if(this.config.querySchema){let t=this.config.querySchema.safeParse(T);if(!t.success)throw new d(JSON.stringify({message:"Invalid query",errors:t.error.issues}));T=t.data}if(this.config.bodySchema){let t=this.config.bodySchema.safeParse(m);if(!t.success)throw new d(JSON.stringify({message:"Invalid body",errors:t.error.issues}));m=t.data}if(this.config.metadataSchema&&c!==void 0){let t=this.config.metadataSchema.safeParse(c);if(!t.success)throw new d(JSON.stringify({message:"Invalid metadata",errors:t.error.issues}));c=t.data}let l={},y=async t=>{if(t>=this.middlewares.length)try{let n=await e(r,{params:i,query:T,body:m,ctx:l,metadata:c});return n instanceof Response?n:new Response(JSON.stringify(n),{status:200,headers:{"Content-Type":"application/json"}})}catch(n){return w(n,this.handleServerError)}let s=this.middlewares[t];if(!s)return y(t+1);let x=async(n={})=>(n.ctx&&(l={...l,...n.ctx}),await y(t+1));try{let n=await s({request:r,params:i,query:T,body:m,ctx:l,metadata:c,next:x});return n instanceof Response||(l={...l}),n}catch(n){return w(n,this.handleServerError)}};return y(0)}catch(o){return w(o,this.handleServerError)}}}},w=(a,e)=>a instanceof d?new Response(a.message,{status:400}):e?e(a):new Response(JSON.stringify({message:"Internal server error"}),{status:500});function f(a){return new p({handleServerError:a?.handleServerError,handleFormData:a?.handleFormData,contextType:{}})}0&&(module.exports={createZodRoute});
//# sourceMappingURL=index.js.map